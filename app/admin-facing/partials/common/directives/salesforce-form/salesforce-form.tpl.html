<form name="caseForm" novalidate>
    <fieldset data-ng-repeat="section in formFields.sections">
        <legend>{{ section.name }}</legend>
        <div class="form-group" data-ng-repeat="field in section.fields" data-ng-class="{ 'has-error' : caseFormField.field.$invalid }">
            <div data-ng-form name="caseFormField">
                <div data-ng-switch="field.type">
                    <div data-ng-switch-when="STRING">
                        <label class="control-label">{{ field.label }}</label>
                        <span data-ng-if="!field.required" class="field-note field-optional">optional</span>
                        <input name="field.name" type="text" class="form-control" data-ng-model="field.value"
                            data-ng-required="field.required" data-ng-maxlength="field.maxLength">
                    </div>
                    <div data-ng-switch-when="EMAIL">
                        <label class="control-label">{{ field.label }}</label>
                        <span data-ng-if="!field.required" class="field-note field-optional">optional</span>
                        <input name="field.name" type="email" class="form-control" data-ng-model="field.value"
                            data-ng-required="field.required">
                    </div>
                    <div data-ng-switch-when="PHONE">
                        <label class="control-label">{{ field.label }}</label>
                        <span data-ng-if="!field.required" class="field-note field-optional">optional</span>
                        <!-- <input name="field.name" type="tel" class="form-control" data-ng-model="field.value"> -->
                        <div class="has-input-icon has-input-icon-telephone">
                            <input class="form-control" data-ng-model="field.value" name="field.name" type="tel"
                                   data-ng-required="field.required" maxlength="12" data-input-mask="999-999-9999" placeholder="XXX-XXX-XXXX"
                                   data-ng-pattern="/[2-9][0-9][0-9]-[2-9][0-9][0-9]-[0-9][0-9][0-9][0-9]/"
                                   data-input-icon>
                            <span class="input-icon"><i class="icon-telephone"></i></span>
                        </div>
                    </div>
                    <div data-ng-switch-when="DATE">
                        <label class="control-label">{{ field.label }}</label>
                        <span data-ng-if="!field.required" class="field-note field-optional">optional</span>
                        <!-- <input name="field.name" type="date" class="form-control"> -->
                        <div class="has-input-icon has-input-icon-calendar">
                            <input class="form-control" placeholder="MM/DD/YYYY" type="text" name="field.name"
                                   data-ng-model="field.value" data-autoclose="true" data-date-format="M/d/yyyy"
                                   data-dateType="string" data-bs-datepicker data-ng-required="field.required"
                                   data-input-icon>
                            <span class="input-icon"><i class="icon-calendar"></i></span>
                        </div>
                    </div>
                    <div data-ng-switch-when="TEXTAREA">
                        <label class="control-label">{{ field.label }}</label>
                        <span data-ng-if="!field.required" class="field-note field-optional">optional</span>
                        <textarea name="field.name" class="form-control" rows="3" data-ng-model="field.value"
                            data-ng-required="field.required"></textarea>
                    </div>
                    <div data-ng-switch-when="BOOLEAN" class="checkbox">
                        <input name="field.name" type="checkbox" id="salesforceCaseCb{{$index}}" value="">
                        <label for="salesforceCaseCb{{$index}}">{{ field.label }}</label>
                    </div>
                    <div data-ng-switch-when="PICK_LIST">
                        <label class="control-label">{{ field.label }}</label>
                        <span data-ng-if="!field.required" class="field-note field-optional">optional</span>
                        <!-- <select name="field.name" class="form-control" data-ng-model="field.values" data-ng-options="option.value for option in field.options track by option.value"></select> -->
                        <!-- <select name="field.name" class="form-control" data-ng-model="field.values"
                            data-ng-required="field.required"
                            data-ng-change="onChange(field)">
                            <option data-ng-repeat="option in field.options" value="{{option.value}}" data-ng-selected="field.values.length && field.values[0] === option.value">{{ option.value }}</option>
                        </select> -->
                        <select name="field.name" class="form-control" data-ng-model="field.values"
                            data-ng-options="option.value for option in field.options track by option.value"
                            data-ng-required="field.required"
                            data-ng-change="onChange(field)"
                            data-chosen data-disable-search="true" data-placeholder="Select...">
                            <option value=""></option>
                        </select>
                        <div data-ng-if="field.chainedField" class="form-group-nested">
                            <div data-ng-repeat="nestedField in field.values.requiredWhenChosen">
                                <label class="control-label">{{ nestedField.label }}</label>
                                <select name="nestedField.name" class="form-control" data-ng-model="nestedField.values"
                                    data-ng-options="option2.value for option2 in nestedField.options track by option2.value"
                                    data-ng-required="nestedField.required"
                                    data-chosen data-disable-search="true" data-placeholder="Select...">
                                    <option value=""></option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div data-ng-switch-when="REFERENCE" class="has-feedback">
                        <label class="control-label">{{ field.label }}</label>
                        <div class="typeahead" data-emmi-typeahead data-items="field.searchResults.content" data-term="field.searchQuery" data-search="referenceSearch(term,field)" data-select="referenceSelect(item,field)"
                            data-placeholder="Start typing to search..." data-focus="salesforceCaseRef{{$index}}" data-id="salesforceCaseRef{{$index}}" data-min-length="3">
                            <div class="menu typeahead-menu dropdown-menu bottom-left container-fluid">
                                <ul>
                                    <li data-emmi-typeahead-item="refitem"
                                        data-ng-repeat="refitem in field.searchResults.content"
                                        class="results">
                                        <div class="col-md-12">{{refitem.name}}</div>
                                    </li>
                                    <li data-ng-show="hasMore()" class="footer">
                                        <div class="col-md-12">Refine search for more results.</div>
                                    </li>
                                </ul>
                                <div data-ng-hide="field.searchResults.content.length" class="no-results">
                                    <div class="col-md-12">No results found</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div data-ng-switch-default>
                        <p class="text-danger">Sorry this form field is not supported.</p>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>
</form>
